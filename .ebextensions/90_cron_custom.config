files:
  "/etc/cron.d/project":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Temporary override of 80_cron.config

      # SEGMENTS
      # To keep the segments current.
      # Run up to 3 batches of 300 contacts per segment, then move on to the next.
      * * * * * root cronloop mautic:segments:update --max-contacts=900

      # CAMPAIGNS
      # To keep campaigns updated with applicable contacts.
      # Run up to 3 batches of 300 contacts per campaign, then move on to the next.
      * * * * * root cronloop mautic:campaigns:rebuild --max-contacts=900
      # To execute campaigns events.

      # Some campaigns run hotter than others, this helps keep the speed up.
      0,7,14,21,28,35,42,49,56 * * * * root cron mautic:campaigns:trigger -i 1
      1,8,15,22,29,36,43,50,57 * * * * root cron mautic:campaigns:trigger -i 2
      * * * * * root cronloop mautic:campaigns:trigger -i 3
      2,9,16,23,30,37,44,51,58 * * * * root cron mautic:campaigns:trigger -i 4
      3,10,17,24,31,38,45,52,59 * * * * root cron mautic:campaigns:trigger -i 5
      4,11,18,25,32,39,46,53 * * * * root cron mautic:campaigns:trigger -i 6
      5,12,19,26,33,40,47,54 * * * * root cron mautic:campaigns:trigger -i 7
      5,12,19,26,33,40,47,54 * * * * root cron mautic:campaigns:trigger -i 10
      6,13,20,27,34,41,48,55 * * * * root cron mautic:campaigns:trigger -i 23
      7,14,21,28,35,42,49,56 * * * * root cron mautic:campaigns:trigger -i 30
      7,14,21,28,35,42,49,56 * * * * root cron mautic:campaigns:trigger -i 29
      # All other campaigns
      0 * * * * root cron mautic:campaigns:trigger --max-events=300

      # To send frequency rules rescheduled marketing campaign messages.
      2,9,16,23,30,37,44,51,58 * * * * root cron mautic:messages:send

      # EMAIL
      # Process Email Queue.
      * * * * * root cron mautic:emails:send --time-limit=60
      # Fetch and Process Monitored Email.
      4,11,18,25,32,39,46,53 * * * * root cron mautic:email:fetch
      # Send scheduled broadcasts / segment emails.
      5,12,19,26,33,40,47,54 * * * * root cron mautic:broadcasts:send

      # SOCIAL
      # Iterates through social monitors.
      6,13,20,27,34,41,48,55 * * * * root cron mautic:social:monitoring

      # WEBHOOKS
      # Send webhook payloads. These are sent in real-time by default, but should be switched to offline processing.
      7,14,21,28,35,42,49,56 * * * * root cron mautic:webhooks:process

      # IMPORTS
      # To run imports in offline processing for speed and reliability.
      * * * * * root cron mautic:import

      # IP Lookup
      # Update maxmind databse at 9am on first Tuesday of each month on all instances.
      0 9 * * 2 webapp [ `date +\%d` -le 7 ] && /usr/bin/php /var/app/current/mautic/app/console mautic:iplookup:download

  "/etc/cron.d/project_custom":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Custom cron tasks for third party plugins can go here.

      # ENHANCERS
      # Update City/State/Postal-code data for the Mautic Enhancer Bundle.
      0 2 5 * * root cron mautic:integration:enhancer:installcspcdata

      # CONTACT LEDGER
      # Backfill statistics up to 15 minutes from now.
      */5 * * * * root cron mautic:ledger:report:stats

      # CONTACT CLIENT
      # Generate and send client files when appropriate.
      */5 * * * * root cron mautic:contactclient:files

      # HEALTH
      # Checks campaign queues and the like for a backlog.
      5,20,35,50 * * * * root cron mautic:health:check
